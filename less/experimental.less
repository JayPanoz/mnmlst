@import (reference) 'utilities';
@import (reference) 'pagebreak';
@import (reference) 'align';
@import (reference) 'rhythm';
@import (reference) 'contrast';

// Experimental Utilities
/* 
   Stuff that may eventually be added to
   mnmlst provided that it proves useful 
   and doesn’t bloat both the system and 
   the CSS output.
                                         */


// Mixins

.border-radius(@radius: 5px) {
	border-radius: @radius;
}

.linear-gradient(@origin: left, @start: #f0f0f0, @stop: #8c8b8b) {
	background-color: @stop;    /* fallback if linear-gradient is not supported */
    background-image: -webkit-linear-gradient(@origin, @start, @stop, @start);
    background-image: linear-gradient(@origin, @start, @stop, @start); 
}

.baseline-grid() {
    .baseline {
        background-image: -webkit-linear-gradient(top, rgba(0,0,0,0) 92%,rgba(0,0,0,0.3) 100%); 
        background-image: linear-gradient(top, rgba(0,0,0,0) 92%,rgba(0,0,0,0.3) 100%);
        background-size: 100% (@scale + 0em);       /* repeat on each line */
        background-position: top -0.45em left 0;    /* sets on real baseline, top might be changed */
    }
}


// “Generators”

// Subtle Color Palette
// Usage: .generate-subtle-palette(#537F84); in custom

.generate-subtle-palette(@baseColor) {
    .subtle-1 {
        color: lighten(spin(@baseColor, 10), 20%);
    }
    .subtle-2 {
        color: lighten(spin(@baseColor, 5), 10%);
    }
    .subtle-3 {
        color: @baseColor;
    }
    .subtle-4 {
        color: darken(spin(@baseColor, -5), 10%);
    }
    .subtle-5 {
        color: darken(spin(@baseColor, -10), 20%);
    }
}

// Complementary Color Palette
// Usage: .generate-comp-palette(#537F84); in custom

.generate-comp-palette(@baseColor) {
    .comp-1 {
        color: lighten(@baseColor, 30%);
    }
    .comp-2 {
        color: lighten(@baseColor, 15%);;
    }
    .comp-3 {
        color: @baseColor;
    }
    .comp-4 {
        color: spin(@baseColor, 180);
    }
    .comp-5 {
        color: darken(spin(@baseColor, 180), 5%);
    }
}

// Image GRID generator
// Generating `.col` classes from argument
   
.generate-columns(@n, @i: 1) when (@i =< @n) {      // Useful for image grids
    .col-@{i} {
        width: (@i * 100% / @n);   
    }
    .generate-columns(@n, (@i + 1));
}

// Freeform System generator
// A pseudo-grid allowing the creation of graphic pages

.generate-freeform(@display: block, @step: 2.5, @n: 10, @i: 1) when (@i =< @n) {
     .ff_@{display}-@{i} {
         display: @display;
         margin-left: (@i * @step) + 0%;
     }
     .generate-freeform(@display, @step, @n, (@i + 1));
}


// Packages (namespaces)

#subtle-hr() {
    hr.subtle {
        .width-center(20);
        border: none;
        border-top: 1px solid currentColor;
        opacity: 0.4;
    }
}

#awesome-hr() {
    hr.awesome {
        .width-center(20);      // Define width and center (since auto = 0 in RMSDK)
        border: none;
        height: 1px;
        .linear-gradient();     // generate background from default arguments
    }   
}

#freeform() {
     /* FREEFORM
        Usage: titlepage (book, parts, etc.) */
    .generate-freeform();       // generate grid from default arguments
    .ff-center {                /* can be used with a span in headings */
        display: block;
        .center;
    }
    .ff-right {                 /* can be used with a span in headings */
        display: block;
        .right;
    }
    .generate-freeform(inline-block, 2.5, 5);   // generate grid for inline-block (span)
    .ff-400 {                                   /* weight of span */
        font-weight: 400;   
    }
    .ff-700 {
        font-weight: 700;   
    }
    .ff-italic {                                /* style of span */
        font-style: italic;   
    }
}

#columns() {
    /*  COLUMNS
        Usage: Image Grids */
    .col-wrap {
        .keep;
        width: auto;            // So that padding don’t trigger overflow
    }
    .generate-columns(4);       // Generate 4 columns (e.g. grid of images)
    .col-float {
        display: inline-block;  // We'll need a clearfix so that margins don't collapse after
    }
    .col-float > img {
        width: 100%;
    }
    .clearfix {
        clear: both;            /* Usage: <div class="clearfix"/> before closing .col-wrap */  
    }
}

#bg-modes() {
    .mint {
        background-color: @kindleMintBg;   
    }
    .sepia {
        background-color: @ibooksSepiaBg;   
    }
    .gray {
        background-color: @ibooksGrayBg;
        color: @ibooksGrayText;
    }
    .black {
        background-color: @ibooksBlackBg;
        color: @ibooksBlackText;
    }
}



// Output

/* Design utils for body
   Don't forget to get rid of 
   thoses classes before publishing       */
   
#bg-modes;
.baseline-grid;


/* Functional classes */

.rounded-box {
    .border-radius(10px);   
}
.generate-subtle-palette(#537F84);
.generate-comp-palette(#537F84);

#subtle-hr;
#awesome-hr;
#columns;
#freeform;

/* Output contrast.less */
button {
    .contrast(red, #F78181);
    .linear-gradient(top, #F78181, #F78181);
}
.check-link-for-ibooks-dark {
    .contrast(#B40431, @ibooksGrayBg);  
}